<meta charset=utf-8>
<title>Web NFC Watch Tests</title>
<link rel="author" title="Intel" href="http://www.intel.com"/>
<link rel="author" title="Zhao Ming" href="mailto:mingx.zhao@intel.com"/>
<link rel="help" href="https://w3c.github.io/web-nfc/#the-nfc-interface"/>
<script src="./resources/testharness.js"></script>
<script src="./resources/testharnessreport.js"></script>

<div id="log"></div>
<script>
// promise_test(t => {
//   navigator.nfc.watch((message) => {
//     if (message.data[0].recordType == 'empty') {
//       navigator.nfc.push({
//         url: "/custom/path",
//         data: [{ recordType: "text", data: 'Hello World' }]
//       });
//     } else {
//       console.log('Read message written by ' + message.url);
//       processMessage(message);
//     }
//   }).then(() => {
//     console.log("Added a watch.");
//   }).catch((error) => {
//     console.log("Adding watch failed: " + error.name);
//   });
//   
//   function processMessage(message) {
//     console.log('-----------------------------')
//     for (let record of message.data) {
//       switch (record.recordType) {
//         case "text":
//           console.log('Data is text: ' + record.data);
//           break;
//         case "url":
//           console.log('Data is URL: ' + record.data);
//           break;
//         case "json":
//           console.log('JSON data: ' + record.data.myProperty.toString());
//           break;
//         case "opaque":
//           if (record.mediaType == 'image/png') {
//             var img = document.createElement("img");
//             img.src = URL.createObjectURL(new Blob(record.data, record.mediaType));
//             img.onload = function() {
//               window.URL.revokeObjectURL(this.src);
//             };
//           }
//           break;
//       }
//     }
//   }
// })
// promise_test(t=> {
//   return navigator.nfc.push("12345678")
//   return navigator.nfc.cancelPush()
// }, "1111123456789")
//promise_test(t => {
//  new Promise((resolve,reject) => {
//    return navigator.nfc.push("00000000000").then((data) => {
//      console.log(data);
//      console.log("---------")
//      return navigator.nfc.cancelPush();
//      resolve();
//    })
//  })
//})
//promise_test(t=> {
//  return  promise_rejects(t, "AbortError", navigator.nfc.push("aaa"))
//    navigator.nfc.cancelPush()
//    console.log("1111111111111111111111111111111111111111111111111111111111111111111111111")
//})

//navigator.nfc.push("111").catch((e) => {console.log("132",e.name)})
//navigator.nfc.cancelPush().catch((b) => {console.log("4444", e.name)})
promise_test(t=> {
  return navigator.nfc.push("ccc", {timeout:100}).catch((e) => {console.log(e)})
  return promise_rejects(t, "AbortError", navigator.nfc.cancelPush());
}, "nfc.cancelPush should reject pending promise with AbortError");
</script>
